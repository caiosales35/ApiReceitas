<!DOCTYPE html>
<html lang="pt-br">
    <head charset=”UTF-8”>
        <title>Testes  de rotas</title>
        <%= csrf_meta_tags %>
        <%= csp_meta_tag %>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    </head>

    <body>
        <script>
            function listRecipesById(){
                var id = document.getElementById("userIdRecipes").value;
                var form = document.getElementById("formListarReceitasId");
                form.action = "api/v1/recipes/user/" + id;
                form.submit();
            }

            function showRecipe(){
                var id = document.getElementById("idReceita").value;
                var form = document.getElementById("formShow");
                form.action = "api/v1/recipes/" + id;
                form.submit();
            }

            function deleteRecipe(){
                var id = document.getElementById("idReceitaDelete").value;
                url = "api/v1/recipes/" + id;

                let xhr = new XMLHttpRequest();
                xhr.open("DELETE", url, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4) {
                        if (xhr.status = 200) {
                            if (xhr.responseText){
                                let response = JSON.parse(xhr.responseText);
                                if (response.status = 404){
                                    alert(response.status + " - Id " + response.error);
                                } else {
                                    alert(response);
                                }
                            } else {
                                alert("Receita removida com Sucesso!");
                            }
                            document.location.reload(true);
                        }
                    }
                }
                xhr.send();
            }
        </script>

        <div class="container pt-4 pb-4">
            
            <div class="jumbotron">
                <h1>Testes - API de Receitas</h1>
                <p>
                    Nesta pagina você encontra alguns formularios para submeter e receber a respectiva resposta da API.
                </p>
            </div>

            <div class="row">
                <div class="col-12 col-sm-6">
                    <form method="post" id="formLogin" action="api/v1/login" >
                        <h3>Rota de Login</h3>
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="loginEmail" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="loginPassword" name="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Login!</button>
                    </form>
                </div>
                <div class="col-12 col-sm-6">
                    <form method="post" id="formCadastro" action="api/v1/users">
                        <h3>Rota de Cadastro de Usuario</h3>
                        <div class="mb-3">
                            <label for="cadastroEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="loginEmail" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="cadastroPassword" class="form-label">Senha</label>
                            <input type="password" class="form-control" id="cadastroPassword" name="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="cadastroPasswordConfirmation" class="form-label">Confirmação de Senha</label>
                            <input type="password" class="form-control" id="cadastroPasswordConfirmation" name="password_confirmation" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Cadastrar!</button>
                    </form>
                </div>
            </div>

            <hr>

            <div class="row mt-4">
                <div class="col-12 col-sm-6">
                    <form method="get" id="formListarReceitas" action="api/v1/recipes">
                        <h3>Rota para Listar Todas as Receitas</h3>
                        <button type="submit" class="btn btn-success mt-3">Listar Receitas</button>
                    </form>
                </div>
                <div class="col-12 col-sm-6">
                    <form id="formListarReceitasId">
                        <h3>Rota para Listar Receitas de um Usuario</h3>
                        <div class="mb-3">
                            <label for="userIdRecipes" class="form-label">Id do Usuario</label>
                            <input type="number" class="form-control" id="userIdRecipes" required min="0" value="0">
                        </div>
                        <button onclick="listRecipesById();" class="btn btn-success mt-3">Listar Receitas</button>
                    </form>
                </div>
            </div>

            <hr>

            <div class="row mt-4">
                <div class="col-12 col-sm-6">
                    <form id="formCreateRecipe" method="post" action="api/v1/recipes">
                        <h3>Rota para Criar uma Receita</h3>
                        <div class="mb-3">
                            <label for="title" class="form-label">Titulo</label>
                            <input type="text" class="form-control" id="title" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label for="category" class="form-label">Categoria</label>
                            <select class="form-control" required id="category" name="category">
                                <option value="apettizer">Aperitivo</option>
                                <option value="entree">Entrada</option>
                                <option value="snack">Lanche</option>
                                <option value="desert">Sobremesa</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="preparation_time">Tempo para preparar</label>
                                <input type="number" class="form-control" id="preparation_time" name="preparation_time" required min="0" step="0.5" value="0">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="oven_time">Tempo no forno</label>
                                <input type="number" class="form-control" id="oven_time" name="oven_time" required min="0" step="0.5" value="0">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="ingredients">Ingredientes</label>
                            <textarea class="form-control" id="ingredients" name="ingredients" rows="2" required style="resize: none"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="steps">Passo a Passo</label>
                            <textarea class="form-control" id="steps" name="steps" rows="2" required style="resize: none"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="Image" class="form-label">URL de uma imagem da receita (opcional)</label>
                            <input type="text" class="form-control" id="Image" name="Image">
                        </div>
                        <button type="submit" class="btn btn-primary mt-3">Criar Receita</button>
                    </form>
                </div>
            </div>
            
            <hr>

            <div class="row mt-4">
                <div class="col-12 col-sm-6">
                    <form id="formShow">
                        <h3>Rota para Detalhes uma Receita</h3>
                        <div class="mb-3">
                            <label for="idReceita" class="form-label">Id da Receita</label>
                            <input type="number" class="form-control" id="idReceita" required min="0" value="0">
                        </div>
                        <button onclick="showRecipe();" class="btn btn-warning mt-3">Detalhes da Receita</button>
                    </form>
                </div>
                <div class="col-12 col-sm-6">
                    <form id="formDelete">
                        <h3>Rota para Deletar uma Receita</h3>
                        <div class="mb-3">
                            <label for="idReceitaDelete" class="form-label">Id da Receita</label>
                            <input type="number" class="form-control" id="idReceitaDelete" required min="0" value="0">
                        </div>
                    </form>
                    <button onclick="deleteRecipe();" class="btn btn-danger mt-3">Deletar Receita</button>
                </div>
            </div>
            
        </div>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    </body>
</html>